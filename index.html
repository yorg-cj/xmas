<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Gift Puzzle</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
:root {
  --theme-green: #0F8F2F;
  --theme-red: #D93030;
  --select-blue: #7fb3ff;
}

body {
  margin: 0;
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  transition: background 0.4s ease, color 0.4s ease;
}

/* THEMES */
body.cozy {
  background: radial-gradient(circle at top, #fffdf8 0, #f5f5fa 40%, #ececf5 100%);
  color: #222;
}

body.festive {
  background: linear-gradient(180deg, #123524 0%, #0b1d14 40%, #2a0a0a 100%);
  color: #f8f8f8;
}

/* HEADER */
h1 { margin-bottom: 0.25rem; }

#themeToggle {
  margin-bottom: 0.75rem;
  border-radius: 999px;
  border: 1px solid currentColor;
  padding: 0.35rem 1rem;
  background: transparent;
  color: inherit;
  cursor: pointer;
}

/* GAME LAYOUT */
#game {
  display: flex;
  gap: 1rem;
  width: 100%;
  max-width: 800px;
}

#grid {
  position: relative;
  touch-action: none;
}

/* SVG path overlay */
#pathOverlay {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

/* GRID */
.row { display: flex; }

.cell {
  width: 3rem;
  height: 3rem;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 1.4rem;
  cursor: pointer;
  user-select: none;
  position: relative;
  color: inherit;
}

/* Circle halo */
.cell::before {
  content: "";
  position: absolute;
  width: 2.2rem;
  height: 2.2rem;
  border-radius: 50%;
  border: 3px solid transparent;
  background: transparent;
  transition: border-color 0.15s ease;
}

/* ACTIVE SELECTION */
.cell.selected::before {
  border-color: var(--select-blue);
}

/* FOUND WORDS */
.cell.found-theme::before {
  border-color: var(--theme-green);
}

.cell.found-spanagram::before {
  border-color: var(--theme-red);
}

.cell.found-theme,
.cell.found-spanagram {
  color: white;
}

/* SIDEBAR */
#sidebar {
  flex: 1;
  padding: 1rem;
  border-radius: 10px;
  backdrop-filter: blur(6px);
  background: rgba(0,0,0,0.25);
}

button {
  border-radius: 999px;
  border: 1px solid currentColor;
  padding: 0.35rem 1rem;
  background: transparent;
  color: inherit;
  cursor: pointer;
}

button.secondary { opacity: 0.8; }

#selectionText {
  margin-top: 0.5rem;
  font-size: 0.9rem;
}

/* Disable zoom inside grid */
#grid, .cell {
  touch-action: none;
}
</style>
</head>

<body class="festive">

<h1>Gift Puzzle</h1>
<button id="themeToggle">Switch to Cozy Theme</button>

<div id="game">
  <div id="grid"></div>

  <aside id="sidebar">
    <div>
      <button id="checkBtn">Check selection</button>
      <button id="clearBtn" class="secondary">Clear</button>
    </div>
    <div id="selectionText"></div>
    <div id="message"></div>
  </aside>
</div>

<script>
/* ---------------- DATA ---------------- */
const gridLetters = [
 ['E','G','I','F','S','A','M','A','P'],
 ['P','G','N','O','P','T','R','O','C'],
 ['T','Y','R','N','A','C','R','K','I'],
 ['S','I','A','L','N','O','E','T','Y'],
 ['C','O','Z','Y','G','I','C','A','Y'],
 ['S','N','O','W','E','T','A','W','T'],
 ['H','O','S','T','O','E','J','A','R'],
 ['T','L','A','G','N','N','U','F','Y'],
 ['E','T','R','I','N','I','R','B','E']
];

const spanagram = {
 path: [[4,0],[4,1],[4,2],[4,3],[4,4],[5,4],[5,5],[5,6],[5,7],[4,7],[4,8]]
};

/* ---------------- STATE ---------------- */
const gridEl = document.getElementById("grid");
const selectionText = document.getElementById("selectionText");
let selection = [];
let dragging = false;
let pointerId = null;

/* SVG */
const svg = document.createElementNS("http://www.w3.org/2000/svg","svg");
svg.id = "pathOverlay";
const line = document.createElementNS("http://www.w3.org/2000/svg","polyline");
line.setAttribute("fill","none");
line.setAttribute("stroke-width","4");
line.setAttribute("stroke-linecap","round");
line.setAttribute("stroke-linejoin","round");
svg.appendChild(line);
gridEl.appendChild(svg);

/* ---------------- GRID BUILD ---------------- */
const cells = [];

gridLetters.forEach((row,r)=>{
 const rowEl=document.createElement("div");
 rowEl.className="row";
 cells[r]=[];
 row.forEach((ch,c)=>{
   const cell=document.createElement("div");
   cell.className="cell";
   cell.textContent=ch;
   cell.dataset.r=r;
   cell.dataset.c=c;
   cell.addEventListener("pointerdown",e=>{
     e.preventDefault();
     dragging=true;
     pointerId=e.pointerId;
     handleSelect(r,c);
   });
   cell.addEventListener("pointerenter",e=>{
     if(dragging && e.pointerId===pointerId) handleDrag(r,c);
   });
   rowEl.appendChild(cell);
   cells[r][c]=cell;
 });
 gridEl.appendChild(rowEl);
});

document.addEventListener("pointerup",()=>dragging=false);
document.addEventListener("pointermove",e=>{
 if(!dragging) return;
 const el=document.elementFromPoint(e.clientX,e.clientY);
 if(el?.classList.contains("cell")){
   handleDrag(+el.dataset.r,+el.dataset.c);
 }
});

/* ---------------- LOGIC ---------------- */
function handleSelect(r,c){
 const last=selection.at(-1);
 const key=`${r},${c}`;

 if(last && last.key===key){
   selection.pop();
 } else if(selection.some(p=>p.key===key)){
   selection=selection.slice(0,selection.findIndex(p=>p.key===key)+1);
 } else {
   selection.push({r,c,key});
 }

 updateUI();
}

function handleDrag(r,c){
 if(!selection.length) handleSelect(r,c);
 else {
   const last=selection.at(-1);
   if(Math.abs(last.r-r)<=1 && Math.abs(last.c-c)<=1){
     handleSelect(r,c);
   }
 }
}

function updateUI(){
 document.querySelectorAll(".cell").forEach(c=>c.classList.remove("selected"));
 selection.forEach(p=>cells[p.r][p.c].classList.add("selected"));

 selectionText.innerHTML = selection.length
   ? "Current selection: <strong>"+selection.map(p=>gridLetters[p.r][p.c]).join("")+"</strong>"
   : "Current selection: (none)";

 drawPath();
}

function drawPath(){
 const rect=gridEl.getBoundingClientRect();
 svg.setAttribute("viewBox",`0 0 ${rect.width} ${rect.height}`);
 const pts=selection.map(p=>{
   const r=cells[p.r][p.c].getBoundingClientRect();
   return `${r.left+r.width/2-rect.left},${r.top+r.height/2-rect.top}`;
 });
 line.setAttribute("points",pts.join(" "));
 line.setAttribute("stroke","var(--select-blue)");
}

/* ---------------- THEME TOGGLE ---------------- */
const toggle=document.getElementById("themeToggle");
toggle.onclick=()=>{
 document.body.classList.toggle("cozy");
 document.body.classList.toggle("festive");
 toggle.textContent=document.body.classList.contains("festive")
  ?"Switch to Cozy Theme"
  :"Switch to Festive Theme";
};
</script>

</body>
</html>
